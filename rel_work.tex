\chapter{Related Work}

There are different approaches to finding vulnerabilities in web applications, two of them being Black-Box testing and White-Box testing.
Our work is based on the black-box testing approach to finding vulnerabilities on websites, and there has been plenty of research that has made use of this methodology \cite{Beizer:1995:BTT:202699}, \cite{Huang}, \cite{kals2006secubat}, \cite{payet13:ears-in-the-wild}, \cite{zanero2005automatic}. There has been significant discussion on both the benefits of such an approach \cite{black-box} and its shortcomings \cite{Doupe2012}, \cite{Doupe2010}.

Our work does not intend to act as a vulnerability scanner, but as a means to identify the presence of E-Mail Header Injection vulnerabilities in a given web application. In this sense, since we are injecting payloads into the web application, our work is related to other injection based attacks, such as SQL Injection \cite{sql1}, \cite{sql0}, \cite{sql2}, Cross-Site Scripting --- XSS --- \cite{Injection1}, \cite{KleinAmit}, HTTP Header Injection \cite{sessionride}, and is very closely related to Simple Mail Transfer Protocol (SMTP) Injection \cite{Terada2015}.

The attack described by Terada \cite{Terada2015} is one that attacks the underlying SMTP mail servers by injecting SMTP commands (which are closely related to E-Mail Headers and usually have a one-to-one mapping, e.g. `To' e-mail header has a corresponding `To' SMTP header) to exploit the SMTP server's pipelining mechanism. The paper also describes proof-of-concept attacks against certain mailing libraries like `Ruby Mail' and `JavaMail'. This attack, although trying to achieve a similar result, is distinctly different from ours. The paper by itself makes this observation and discusses why it is different from E-Mail Header Injection.

In comparison, our work tries to exploit application-level flaws in user input sanitization, which allow us to perform this attack. Our work does not intend to exploit the pipelining mechanism, but to exploit the implementation of the mail function in most popular programming languages, which leaves them with no way to distinguish between user supplied headers and headers that are legitimately added by the application.

As specified before, although this vulnerability has been present for over a decade, there has not been much written about it in the literature, and we only find a few articles on the Internet describing the attack.

The first documented article dates to over a decade ago; a late 2004 article on phpsecure.info \cite{Tobozo} accredited to user \lstinline|tobozo@phpsecure.info| describing how this vulnerability existed in the reference implementation of the mail function in PHP, and how it can be exploited. Following this, we found other blog posts \cite{Calin}, \cite{DK}, \cite{Injection2}, \cite{Nicol}, \cite{Pope}, each describing how to exploit the vulnerability by using newlines to camouflage headers inside user input. A wiki entry \cite{Injection} also describes the ways to prevent such an attack. However, none of these articles have performed these attacks against real-life websites.

Another blog post written by user Voxel@Night on Vexatious Tendencies \cite{Tendencies2014}, recounts an actual attack against a WordPress plugin, `Contact Form', with a proof of concept\footnotemark. It also showcases the vulnerable code in the plugin that causes this vulnerability to be present. However, this article targets just one plugin and does not aim to find the prevalence of said plugin usage. Neither does it inform the creators of the plug-in to fix the discovered vulnerability.
\footnotetext{Note that this plugin is used actively on 300,000 websites (according to \cite{BestWebSoft2016}), but is yet to be fixed.}
The vulnerability was described briefly by Stuttard and Pinto in their book, ``\emph{The Web Application Hacker's Handbook: Discovering and Exploiting Security Flaws}'' \cite{stuttard2011web}. The book, however, does not go into detail on either the attack or the ways to mitigate such an attack. Our work, on the other hand discusses the means to mitigate the attack. We also describe, in detail, the payloads that can be used and the need for varying the payloads (Section. \ref{Comp:Fuzzer:mp}).

To the best of our knowledge, no other research has been conducted to determine the prevalence of this vulnerability across the World Wide Web. We have managed to, on a large scale, crawl and inject websites with comparatively benign payloads (such as the BCC header) to identify the existence of this vulnerability without causing any ostensible harm to the website. Our injected payloads do not contain any special characters other than the newline characters and thus cannot cause any unintended consequences. Also, since we are only injecting a payload with the `bcc' header, the underlying mail servers should not be affected by the additional load. Our work serves to not only prove the existence of the vulnerability on the World Wide Web but to quantify it.

%The next and final chapter starts by outlining our contributions and closes with concluding remarks about the project.